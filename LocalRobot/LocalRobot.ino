#include <XM430.h>
#include <SoftwareSerial.h>



int Val_X[] = {3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3029,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3030,
               3031,
               3031,
               3033,
               3038,
               3048,
               3057,
               3070,
               3083,
               3097,
               3112,
               3130,
               3145,
               3162,
               3175,
               3190,
               3204,
               3218,
               3230,
               3247,
               3264,
               3284,
               3312,
               3333,
               3353,
               3374,
               3394,
               3413,
               3428,
               3438,
               3444,
               3450,
               3453,
               3456,
               3461,
               3466,
               3475,
               3485,
               3496,
               3506,
               3520,
               3530,
               3539,
               3544,
               3548,
               3555,
               3559,
               3567,
               3576,
               3588,
               3599,
               3609,
               3618,
               3623,
               3626,
               3628,
               3630,
               3633,
               3635,
               3639,
               3644,
               3648,
               3652,
               3654,
               3656,
               3658,
               3659,
               3660,
               3661,
               3662,
               3666,
               3677,
               3692,
               3703,
               3715,
               3730,
               3741,
               3752,
               3762,
               3773,
               3784,
               3798,
               3807,
               3815,
               3822,
               3828,
               3834,
               3841,
               3852,
               3860,
               3871,
               3880,
               3894,
               3905,
               3916,
               3923,
               3936,
               3945,
               3958,
               3975,
               3989,
               4005,
               4014,
               4023,
               4030,
               4038,
               4045,
               4054,
               4065,
               4074,
               4084,
               4096,
               4111,
               4122,
               4134,
               4149,
               4157,
               4165,
               4174,
               4179,
               4186,
               4192,
               4197,
               4207,
               4221,
               4237,
               4250,
               4266,
               4290,
               4315,
               4340,
               4365,
               4383,
               4404,
               4420,
               4434,
               4450,
               4469,
               4483,
               4499,
               4518,
               4531,
               4546,
               4568,
               4585,
               4607,
               4623,
               4638,
               4656,
               4668,
               4681,
               4696,
               4717,
               4736,
               4754,
               4772,
               4791,
               4809,
               4828,
               4849,
               4863,
               4866,
               4866,
               4864,
               4856,
               4847,
               4832,
               4819,
               4802,
               4776,
               4754,
               4734,
               4709,
               4674,
               4637,
               4611,
               4586,
               4557,
               4521,
               4496,
               4469,
               4440,
               4400,
               4366,
               4342,
               4317,
               4292,
               4264,
               4239,
               4208,
               4177,
               4133,
               4090,
               4052,
               4014,
               3978,
               3950,
               3928,
               3903,
               3877,
               3856,
               3833,
               3808,
               3778,
               3753,
               3734,
               3716,
               3697,
               3675,
               3658,
               3642,
               3617,
               3600,
               3581,
               3562,
               3539,
               3510,
               3492,
               3472,
               3453,
               3423,
               3388,
               3348,
               3315,
               3261,
               3204,
               3144,
               3092,
               3055,
               3016,
               2982,
               2947,
               2908,
               2857,
               2816,
               2791,
               2769,
               2744,
               2728,
               2710,
               2691,
               2674,
               2665,
               2659,
               2657,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2656,
               2654,
               2647,
               2636,
               2617,
               2597,
               2575,
               2553,
               2529,
               2501,
               2468,
               2426,
               2377,
               2322,
               2263,
               2207,
               2164,
               2110,
               2063,
               2020,
               1977,
               1949,
               1908,
               1875,
               1852,
               1830,
               1808,
               1778,
               1754,
               1735,
               1720,
               1708,
               1701,
               1699,
               1697,
               1698,
               1698,
               1699,
               1705,
               1717,
               1742,
               1762,
               1787,
               1819,
               1849,
               1876,
               1908,
               1942,
               1977,
               2015,
               2047,
               2074,
               2107,
               2144,
               2183,
               2223,
               2266,
               2305,
               2336,
               2371,
               2396,
               2421,
               2449,
               2484,
               2517,
               2543,
               2580,
               2604,
               2630,
               2656,
               2688,
               2712,
               2752,
               2779,
               2807,
               2831,
               2853,
               2877,
               2896,
               2920,
               2951,
               2984,
               3013,
               3044,
               3072,
               3099,
               3121,
               3148,
               3170,
               3192,
               3213,
               3233,
               3249,
               3264,
               3273,
               3278,
               3278,
               3278,
               3276,
               3271,
               3262,
               3246,
               3224,
               3198,
               3169,
               3149,
               3113,
               3080,
               3043,
               3011,
               2982,
               2951,
               2918,
               2884,
               2853,
               2822,
               2800,
               2761,
               2726,
               2686,
               2651,
               2614,
               2576,
               2540,
               2500,
               2462,
               2430,
               2391,
               2362,
               2337,
               2315,
               2290,
               2264,
               2241,
               2211,
               2181,
               2153,
               2135,
               2118,
               2099,
               2089,
               2083,
               2080,
               2080,
               2080,
               2080,
               2080,
               2079,
               2078,
               2075,
               2068,
               2058,
               2043,
               2026,
               2009,
               1999,
               1998,
               1999,
               2001,
               2006,
               2016,
               2027,
               2037,
               2045,
               2053,
               2058,
               2063,
               2066,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068,
               2068
              };
int Val_Y[] = {100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               100,
               1596,
               1595,
               1596,
               1595,
               1595,
               1595,
               1595,
               1595,
               1595,
               1596,
               1598,
               1598,
               1599,
               1601,
               1603,
               1606,
               1610,
               1614,
               1619,
               1622,
               1624,
               1628,
               1634,
               1641,
               1653,
               1667,
               1682,
               1695,
               1708,
               1718,
               1726,
               1733,
               1738,
               1743,
               1748,
               1753,
               1762,
               1773,
               1786,
               1802,
               1819,
               1845,
               1861,
               1876,
               1890,
               1910,
               1922,
               1934,
               1945,
               1957,
               1968,
               1979,
               1989,
               2000,
               2010,
               2021,
               2040,
               2060,
               2075,
               2089,
               2110,
               2123,
               2136,
               2148,
               2159,
               2170,
               2186,
               2195,
               2204,
               2212,
               2221,
               2232,
               2243,
               2261,
               2272,
               2283,
               2296,
               2315,
               2332,
               2345,
               2355,
               2369,
               2380,
               2389,
               2409,
               2421,
               2442,
               2456,
               2472,
               2487,
               2501,
               2513,
               2524,
               2539,
               2548,
               2558,
               2570,
               2588,
               2601,
               2614,
               2638,
               2655,
               2672,
               2697,
               2714,
               2738,
               2760,
               2772,
               2787,
               2799,
               2807,
               2811,
               2818,
               2830,
               2844,
               2855,
               2866,
               2873,
               2884,
               2891,
               2898,
               2906,
               2917,
               2924,
               2929,
               2940,
               2947,
               2955,
               2969,
               2977,
               2992,
               3000,
               3009,
               3019,
               3024,
               3029,
               3032,
               3036,
               3038,
               3040,
               3041,
               3043,
               3046,
               3049,
               3054,
               3059,
               3063,
               3067,
               3071,
               3078,
               3083,
               3091,
               3097,
               3103,
               3112,
               3119,
               3125,
               3130,
               3135,
               3137,
               3138,
               3138,
               3138,
               3139,
               3139,
               3139,
               3141,
               3143,
               3144,
               3145,
               3145,
               3145,
               3144,
               3144,
               3145,
               3144,
               3145,
               3144,
               3144,
               3143,
               3140,
               3135,
               3129,
               3114,
               3096,
               3078,
               3059,
               3038,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               3500,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000,
               4000
              };

float x;
float y;
float easing = 0.05;
float easing_time = 200;

int x_Out;
int y_Out;

int numColumns = 481;



//Software Serial (RX, TX)
SoftwareSerial toRS485(11, 10);

//motorID
byte servo1 = 0x17;
byte servo2 = 0x18;

XM430 gimbal(&toRS485);

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  //Start the Serial communication: One for the Nano communication, and the other for the RS485

  gimbal.BeginRS485(1000000);
  //Enable Torque, without this function the motors will not move.
  gimbal.TorqueEnable(servo1, ON);
  gimbal.TorqueEnable(servo2, ON);
}

void loop() {

  x = 0;
  y = 0;

  for (int i = 0; i < numColumns; i++) {
    //eases data to write to servo
    float targetX = Val_X[i];
    float dx = targetX - x;
    x += dx * easing;
    x_Out = round(x);


    float targetY = Val_Y[i];
    float dy = targetY - y;
    y += dy * easing;
    y_Out = round(y);

    Serial.println (y_Out);
    gimbal.Goto(servo1, x_Out);
    gimbal.Goto(servo2, y_Out);
    delay(1);
  }


  int  x_diff =  Val_X[0] - Val_X[numColumns];
  int  y_diff =  Val_Y[0] - Val_Y[numColumns];

  for (int i = 0; i < easing_time; i++)
  {
    x_Out = Val_X[numColumns] + (x_diff * (i / easing_time));
    y_Out = Val_Y[numColumns] + (y_diff * (i / easing_time));
    gimbal.Goto(servo1, x_Out);
    gimbal.Goto(servo2, y_Out);
  }

  x_Out = Val_X[0];
  y_Out = Val_Y[0];


}
